<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codenames - The Word Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 40px;
        }

        h1 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.1em;
        }

        .setup-screen, .game-screen, .game-over-screen {
            display: none;
        }

        .setup-screen.active, .game-screen.active, .game-over-screen.active {
            display: block;
        }

        .team-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .team-input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            width: 100%;
        }

        .team-input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .team-info {
            text-align: center;
        }

        .team-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .team-red .team-name {
            color: #dc3545;
        }

        .team-blue .team-name {
            color: #007bff;
        }

        .remaining-count {
            font-size: 1.2em;
            margin-top: 5px;
        }

        .current-turn {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            margin: 20px 0;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 30px 0;
        }

        .word-card {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 3px solid transparent;
            text-align: center;
            word-wrap: break-word;
            background: #f8f9fa;
            color: #333;
        }

        .word-card:hover:not(.revealed) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: #1e3c72;
        }

        .word-card.revealed {
            cursor: default;
            color: white;
        }

        .word-card.selected {
            border: 3px solid #ffc107;
            background: #fff3cd;
            transform: scale(1.05);
        }

        .word-card.red {
            background: #dc3545;
        }

        .word-card.blue {
            background: #007bff;
        }

        .word-card.neutral {
            background: #6c757d;
        }

        .word-card.assassin {
            background: #000;
        }

        .spymaster-view {
            margin: 30px 0;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 3px solid #ffc107;
        }

        .spymaster-view h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .spymaster-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .spymaster-card {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
            word-wrap: break-word;
            color: white;
        }

        .spymaster-card.red {
            background: #dc3545;
        }

        .spymaster-card.blue {
            background: #007bff;
        }

        .spymaster-card.neutral {
            background: #6c757d;
        }

        .spymaster-card.assassin {
            background: #000;
        }

        .spymaster-card.revealed {
            opacity: 0.5;
            border: 2px dashed white;
        }

        .clue-section {
            margin: 30px 0;
            padding: 20px;
            background: #e9ecef;
            border-radius: 10px;
        }

        .clue-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .clue-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            width: 200px;
        }

        .clue-input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .number-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            width: 80px;
            text-align: center;
        }

        .number-input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .current-clue {
            font-size: 1.5em;
            font-weight: bold;
            padding: 20px;
            background: #d1ecf1;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .instructions {
            background: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            line-height: 1.6;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #1e3c72;
        }

        .game-over-message {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            border-radius: 10px;
        }

        .game-over-message.win-red {
            background: #f8d7da;
            color: #721c24;
        }

        .game-over-message.win-blue {
            background: #d1ecf1;
            color: #0c5460;
        }

        .game-over-message.lose {
            background: #000;
            color: white;
        }

        .view-toggle {
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .word-grid, .spymaster-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 5px;
            }

            .word-card, .spymaster-card {
                font-size: 0.8em;
                padding: 8px;
            }

            .team-setup {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üïµÔ∏è Codenames</h1>
        <p class="subtitle">The Word Guessing Game</p>

        <!-- Setup Screen -->
        <div class="setup-screen active" id="setupScreen">
            <div class="team-setup">
                <input type="text" class="team-input" id="redTeamName" placeholder="Red Team Name" value="Red Team">
                <input type="text" class="team-input" id="blueTeamName" placeholder="Blue Team Name" value="Blue Team">
            </div>
            <div class="instructions">
                <h3>How to Play:</h3>
                <ol>
                    <li><strong>Two teams</strong> compete: Red and Blue</li>
                    <li>Each team has a <strong>spymaster</strong> who sees which words belong to their team</li>
                    <li>The spymaster gives a <strong>one-word clue</strong> and a <strong>number</strong> (e.g., "Animal, 2")</li>
                    <li>The team tries to guess their words by clicking on them</li>
                    <li><strong>Red team starts first</strong> (they have 9 words, Blue has 8)</li>
                    <li>First team to find all their words wins!</li>
                    <li><strong>Warning:</strong> Don't click the assassin (black) or you lose immediately!</li>
                </ol>
            </div>
            <button class="btn" onclick="startGame()">Start Game</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="team-info team-red">
                    <div class="team-name" id="redTeamNameDisplay">Red Team</div>
                    <div class="remaining-count">Remaining: <span id="redRemaining">9</span></div>
                </div>
                <div class="team-info team-blue">
                    <div class="team-name" id="blueTeamNameDisplay">Blue Team</div>
                    <div class="remaining-count">Remaining: <span id="blueRemaining">8</span></div>
                </div>
            </div>

            <div class="current-turn" id="currentTurnDisplay">Red Team's Turn</div>

            <div class="view-toggle">
                <button class="btn btn-secondary" onclick="toggleView()" id="viewToggleBtn">Show Spymaster View</button>
            </div>

            <div id="spymasterView" class="spymaster-view" style="display: none;">
                <h3>üëÅÔ∏è Spymaster View (Only for Spymasters!)</h3>
                <div class="spymaster-grid" id="spymasterGrid"></div>
                <p style="margin-top: 15px; color: #856404;">
                    <strong>Legend:</strong> 
                    <span style="color: #dc3545;">Red</span> | 
                    <span style="color: #007bff;">Blue</span> | 
                    <span style="color: #6c757d;">Neutral</span> | 
                    <span style="color: #000;">Assassin</span>
                </p>
            </div>

            <div id="clueSection" class="clue-section" style="display: none;">
                <h3 style="margin-bottom: 15px;">Give Your Clue</h3>
                <div class="clue-input-group">
                    <input type="text" class="clue-input" id="clueInput" placeholder="Enter clue word" maxlength="20">
                    <span style="font-size: 1.2em;">,</span>
                    <input type="number" class="number-input" id="numberInput" placeholder="#" min="1" max="9" value="1">
                    <button class="btn" onclick="submitClue()">Give Clue</button>
                </div>
            </div>

            <div id="currentClueDisplay" class="current-clue" style="display: none;">
                <div>Current Clue: <span id="currentClueText"></span></div>
                <div style="font-size: 0.8em; margin-top: 10px; color: #666;">
                    Guesses remaining: <span id="guessesRemaining">0</span>
                </div>
            </div>

            <div class="word-grid" id="wordGrid"></div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="confirmGuess()" id="confirmGuessBtn" style="display: none;">Confirm Guess: <span id="selectedWordText"></span></button>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="endTurn()" id="endTurnBtn" style="display: none;">End Turn</button>
                <button class="btn btn-danger" onclick="passTurn()" id="passTurnBtn" style="display: none;">Pass Turn</button>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over-screen" id="gameOverScreen">
            <div class="game-over-message" id="gameOverMessage"></div>
            <div style="text-align: center;">
                <button class="btn" onclick="resetGame()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            redTeamName: 'Red Team',
            blueTeamName: 'Blue Team',
            currentTeam: 'red', // 'red' or 'blue'
            words: [],
            wordAssignments: [], // 'red', 'blue', 'neutral', 'assassin'
            revealed: new Set(),
            redRemaining: 9,
            blueRemaining: 8,
            currentClue: null,
            guessesRemaining: 0,
            isSpymasterView: false,
            gameOver: false,
            selectedWordIndex: null // Index of currently selected word for guessing
        };

        // Word list for the game (25 words per game)
        const wordBank = [
            'AFRICA', 'AGENT', 'AIR', 'ALIEN', 'ALPS', 'AMAZON', 'AMBULANCE', 'AMERICA', 'ANGEL', 'ANTARCTICA',
            'APPLE', 'ARM', 'ATLANTIS', 'AUSTRALIA', 'AZTEC', 'BACK', 'BALL', 'BAND', 'BANK', 'BAR',
            'BARK', 'BAT', 'BATTERY', 'BEACH', 'BEAR', 'BEAT', 'BED', 'BEIJING', 'BELL', 'BELT',
            'BERLIN', 'BERMUDA', 'BERRY', 'BILL', 'BLOCK', 'BOARD', 'BOLT', 'BOMB', 'BOND', 'BOOM',
            'BOOT', 'BOTTLE', 'BOW', 'BOX', 'BRIDGE', 'BRUSH', 'BUCK', 'BUFFALO', 'BUG', 'BUGLE',
            'BUTTON', 'CALF', 'CANADA', 'CAP', 'CAPITAL', 'CAR', 'CARD', 'CARROT', 'CASINO', 'CAST',
            'CAT', 'CELL', 'CENTAUR', 'CENTER', 'CHAIR', 'CHANGE', 'CHARGE', 'CHECK', 'CHEST', 'CHICK',
            'CHINA', 'CHOCOLATE', 'CHURCH', 'CIRCLE', 'CLIFF', 'CLOAK', 'CLUB', 'CODE', 'COLD', 'COMPASS',
            'COMPOUND', 'CONCERT', 'CONDUCTOR', 'CONTRACT', 'COOK', 'COPPER', 'COTTON', 'COURT', 'COVER', 'CRANE',
            'CRASH', 'CRICKET', 'CROSS', 'CROWN', 'CYCLE', 'CZECH', 'DANCE', 'DATE', 'DAY', 'DEATH',
            'DECK', 'DEGREE', 'DIAMOND', 'DICE', 'DINOSAUR', 'DISEASE', 'DOCTOR', 'DOG', 'DRAFT', 'DRAGON',
            'DRESS', 'DRILL', 'DROP', 'DUCK', 'DWARF', 'EAGLE', 'EGYPT', 'EMBASSY', 'ENGINE', 'ENGLAND',
            'EUROPE', 'EYE', 'FACE', 'FAIR', 'FALL', 'FAN', 'FENCE', 'FIELD', 'FIGHTER', 'FIGURE',
            'FILE', 'FILM', 'FIRE', 'FISH', 'FLUTE', 'FLY', 'FOOT', 'FORCE', 'FOREST', 'FORK',
            'FRANCE', 'GAME', 'GAS', 'GENIUS', 'GERMANY', 'GHOST', 'GIANT', 'GLASS', 'GLOVE', 'GOLD',
            'GRACE', 'GRASS', 'GREECE', 'GREEN', 'GROUND', 'HAM', 'HAND', 'HAWK', 'HEAD', 'HEART',
            'HELICOPTER', 'HIMALAYAS', 'HOLE', 'HOLLYWOOD', 'HONEY', 'HOOD', 'HOOK', 'HORN', 'HORSE', 'HORSESHOE',
            'HOSPITAL', 'HOTEL', 'ICE', 'ICE CREAM', 'INDIA', 'IRON', 'IVORY', 'JACK', 'JAM', 'JET',
            'JUPITER', 'KANGAROO', 'KETCHUP', 'KEY', 'KID', 'KING', 'KIWI', 'KNIFE', 'KNIGHT', 'LAB',
            'LAP', 'LASER', 'LAWYER', 'LEAD', 'LEMON', 'LEPRECHAUN', 'LIFE', 'LIGHT', 'LIMOUSINE', 'LINE',
            'LINK', 'LION', 'LITTER', 'LOCH NESS', 'LOCK', 'LOG', 'LONDON', 'LUCK', 'MAIL', 'MAMMOTH',
            'MAPLE', 'MARBLE', 'MARCH', 'MASS', 'MATCH', 'MERCURY', 'MEXICO', 'MICROSCOPE', 'MILLIONAIRE', 'MINE',
            'MINT', 'MISSILE', 'MODEL', 'MOLE', 'MOON', 'MOSCOW', 'MOUNT', 'MOUSE', 'MOUTH', 'MUG',
            'NAIL', 'NEEDLE', 'NET', 'NEW YORK', 'NIGHT', 'NINJA', 'NOTE', 'NOVEL', 'NURSE', 'NUT',
            'OCTOPUS', 'OIL', 'OLIVE', 'OLYMPUS', 'OPERA', 'ORANGE', 'ORGAN', 'PALM', 'PAN', 'PANTS',
            'PAPER', 'PARACHUTE', 'PARK', 'PART', 'PASS', 'PASTE', 'PENGUIN', 'PHOENIX', 'PIANO', 'PIE',
            'PILOT', 'PIN', 'PIPE', 'PIRATE', 'PISTOL', 'PIT', 'PITCH', 'PLANE', 'PLASTIC', 'PLATE',
            'PLATYPUS', 'PLAY', 'PLOT', 'POINT', 'POISON', 'POLE', 'POLICE', 'POOL', 'PORT', 'POST',
            'POUND', 'PRESS', 'PRINCESS', 'PUMPKIN', 'PUPIL', 'PYRAMID', 'QUEEN', 'RABBIT', 'RACKET', 'RAY',
            'REVOLUTION', 'RING', 'ROBIN', 'ROBOT', 'ROCK', 'ROME', 'ROOT', 'ROSE', 'ROULETTE', 'ROUND',
            'ROW', 'RULER', 'SATELLITE', 'SATURN', 'SCALE', 'SCHOOL', 'SCIENTIST', 'SCORPION', 'SCREEN', 'SCUBA DIVER',
            'SEAL', 'SERVER', 'SHADOW', 'SHAKESPEARE', 'SHARK', 'SHIP', 'SHOE', 'SHOP', 'SHOT', 'SINK',
            'SKYSCRAPER', 'SLIP', 'SLUG', 'SMUGGLER', 'SNOW', 'SNOWMAN', 'SOCK', 'SOLDIER', 'SOUL', 'SOUND',
            'SPACE', 'SPELL', 'SPIDER', 'SPIKE', 'SPINE', 'SPOT', 'SPRING', 'SPY', 'SQUARE', 'STADIUM',
            'STAFF', 'STAMP', 'STAR', 'STATE', 'STICK', 'STOCK', 'STRAW', 'STREAM', 'STRIKE', 'STRING',
            'SUB', 'SUIT', 'SUPERHERO', 'SWING', 'SWITCH', 'TABLE', 'TABLET', 'TAG', 'TAIL', 'TAP',
            'TEACHER', 'TELESCOPE', 'TEMPLE', 'THEATER', 'THIEF', 'THUMB', 'TICK', 'TIE', 'TIME', 'TIP',
            'TOKYO', 'TOOTH', 'TORCH', 'TOWER', 'TRACK', 'TRAIN', 'TRIANGLE', 'TRIP', 'TRUNK', 'TUBE',
            'TURKEY', 'UNDERTAKER', 'UNICORN', 'VACUUM', 'VAN', 'VET', 'WAKE', 'WALL', 'WAR', 'WASHER',
            'WASHINGTON', 'WATCH', 'WATER', 'WAVE', 'WEB', 'WELL', 'WHALE', 'WHIP', 'WIND', 'WITCH',
            'WORM', 'YARD'
        ];

        function startGame() {
            gameState.redTeamName = document.getElementById('redTeamName').value || 'Red Team';
            gameState.blueTeamName = document.getElementById('blueTeamName').value || 'Blue Team';
            gameState.currentTeam = 'red';
            gameState.revealed = new Set();
            gameState.redRemaining = 9;
            gameState.blueRemaining = 8;
            gameState.currentClue = null;
            gameState.guessesRemaining = 0;
            gameState.gameOver = false;
            gameState.selectedWordIndex = null;

            // Select 25 random words
            const shuffled = [...wordBank].sort(() => Math.random() - 0.5);
            gameState.words = shuffled.slice(0, 25);

            // Assign words: 9 red, 8 blue, 7 neutral, 1 assassin
            gameState.wordAssignments = [];
            for (let i = 0; i < 9; i++) gameState.wordAssignments.push('red');
            for (let i = 0; i < 8; i++) gameState.wordAssignments.push('blue');
            for (let i = 0; i < 7; i++) gameState.wordAssignments.push('neutral');
            gameState.wordAssignments.push('assassin');
            
            // Shuffle assignments
            gameState.wordAssignments = gameState.wordAssignments.sort(() => Math.random() - 0.5);

            // Update displays
            document.getElementById('redTeamNameDisplay').textContent = gameState.redTeamName;
            document.getElementById('blueTeamNameDisplay').textContent = gameState.blueTeamName;
            document.getElementById('redRemaining').textContent = gameState.redRemaining;
            document.getElementById('blueRemaining').textContent = gameState.blueRemaining;

            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');

            renderGame();
            updateTurnDisplay();
        }

        function renderGame() {
            const wordGrid = document.getElementById('wordGrid');
            const spymasterGrid = document.getElementById('spymasterGrid');
            
            wordGrid.innerHTML = '';
            spymasterGrid.innerHTML = '';

            for (let i = 0; i < 25; i++) {
                const word = gameState.words[i];
                const assignment = gameState.wordAssignments[i];
                const isRevealed = gameState.revealed.has(i);

                // Regular word card
                const card = document.createElement('div');
                let cardClass = `word-card ${isRevealed ? assignment + ' revealed' : ''}`;
                if (!isRevealed && gameState.selectedWordIndex === i) {
                    cardClass += ' selected';
                }
                card.className = cardClass;
                card.textContent = word;
                if (!isRevealed && gameState.currentClue && gameState.guessesRemaining > 0) {
                    card.onclick = () => selectWord(i);
                }
                wordGrid.appendChild(card);

                // Spymaster card
                const spymasterCard = document.createElement('div');
                spymasterCard.className = `spymaster-card ${assignment} ${isRevealed ? 'revealed' : ''}`;
                spymasterCard.textContent = word;
                spymasterGrid.appendChild(spymasterCard);
            }
        }

        function updateTurnDisplay() {
            const teamName = gameState.currentTeam === 'red' ? gameState.redTeamName : gameState.blueTeamName;
            document.getElementById('currentTurnDisplay').textContent = `${teamName}'s Turn`;
            document.getElementById('currentTurnDisplay').style.background = gameState.currentTeam === 'red' ? '#f8d7da' : '#d1ecf1';
            document.getElementById('currentTurnDisplay').style.color = gameState.currentTeam === 'red' ? '#721c24' : '#0c5460';

            // Show/hide clue section
            const clueSection = document.getElementById('clueSection');
            const currentClueDisplay = document.getElementById('currentClueDisplay');
            
            if (gameState.currentClue) {
                document.getElementById('clueSection').style.display = 'none';
                document.getElementById('currentClueDisplay').style.display = 'block';
                document.getElementById('currentClueText').textContent = `${gameState.currentClue.word}, ${gameState.currentClue.number}`;
                document.getElementById('guessesRemaining').textContent = gameState.guessesRemaining;
                document.getElementById('endTurnBtn').style.display = 'inline-block';
                document.getElementById('passTurnBtn').style.display = 'inline-block';
                
                // Show/hide confirm button based on selection
                if (gameState.selectedWordIndex !== null && gameState.guessesRemaining > 0) {
                    document.getElementById('confirmGuessBtn').style.display = 'inline-block';
                    document.getElementById('selectedWordText').textContent = gameState.words[gameState.selectedWordIndex];
                } else {
                    document.getElementById('confirmGuessBtn').style.display = 'none';
                }
            } else {
                document.getElementById('clueSection').style.display = 'block';
                document.getElementById('currentClueDisplay').style.display = 'none';
                document.getElementById('endTurnBtn').style.display = 'none';
                document.getElementById('passTurnBtn').style.display = 'none';
                document.getElementById('confirmGuessBtn').style.display = 'none';
            }
        }

        function toggleView() {
            gameState.isSpymasterView = !gameState.isSpymasterView;
            const view = document.getElementById('spymasterView');
            const btn = document.getElementById('viewToggleBtn');
            
            if (gameState.isSpymasterView) {
                view.style.display = 'block';
                btn.textContent = 'Hide Spymaster View';
            } else {
                view.style.display = 'none';
                btn.textContent = 'Show Spymaster View';
            }
        }

        function submitClue() {
            const clue = document.getElementById('clueInput').value.trim().toUpperCase();
            const number = parseInt(document.getElementById('numberInput').value);

            if (!clue) {
                alert('Please enter a clue!');
                return;
            }

            if (number < 1 || number > 9) {
                alert('Number must be between 1 and 9!');
                return;
            }

            // Check if clue word is in the grid
            if (gameState.words.some(w => w.toUpperCase() === clue)) {
                alert('Clue cannot be a word on the board!');
                return;
            }

            gameState.currentClue = { word: clue, number: number };
            gameState.guessesRemaining = number + 1; // Allow one extra guess for correct guesses
            gameState.selectedWordIndex = null; // Reset selection

            document.getElementById('clueInput').value = '';
            document.getElementById('numberInput').value = '1';

            // Automatically hide spymaster view when clue is given
            if (gameState.isSpymasterView) {
                toggleView();
            }

            updateTurnDisplay();
            renderGame();
        }

        function selectWord(index) {
            if (gameState.gameOver || gameState.revealed.has(index) || !gameState.currentClue || gameState.guessesRemaining <= 0) {
                return;
            }

            gameState.selectedWordIndex = index;
            renderGame();
            updateTurnDisplay();
        }

        function confirmGuess() {
            if (gameState.selectedWordIndex === null) {
                return;
            }

            guessWord(gameState.selectedWordIndex);
            gameState.selectedWordIndex = null;
        }

        function guessWord(index) {
            if (gameState.gameOver || gameState.revealed.has(index) || !gameState.currentClue || gameState.guessesRemaining <= 0) {
                return;
            }

            const assignment = gameState.wordAssignments[index];
            gameState.revealed.add(index);
            gameState.guessesRemaining--;
            gameState.selectedWordIndex = null; // Clear selection after guessing

            renderGame();

            if (assignment === 'assassin') {
                // Game over - other team wins
                endGame(gameState.currentTeam === 'red' ? 'blue' : 'red', true);
                return;
            }

            if (assignment === gameState.currentTeam) {
                // Correct guess
                if (gameState.currentTeam === 'red') {
                    gameState.redRemaining--;
                } else {
                    gameState.blueRemaining--;
                }

                document.getElementById('redRemaining').textContent = gameState.redRemaining;
                document.getElementById('blueRemaining').textContent = gameState.blueRemaining;

                // Check for win
                if (gameState.redRemaining === 0) {
                    endGame('red', false);
                    return;
                }
                if (gameState.blueRemaining === 0) {
                    endGame('blue', false);
                    return;
                }

                // If guesses remaining, continue guessing
                if (gameState.guessesRemaining > 0) {
                    updateTurnDisplay();
                } else {
                    // Turn ends after correct guess but no more guesses
                    endTurn();
                }
            } else {
                // Wrong guess - turn ends immediately
                endTurn();
            }
        }

        function endTurn() {
            gameState.currentClue = null;
            gameState.guessesRemaining = 0;
            gameState.selectedWordIndex = null;
            gameState.currentTeam = gameState.currentTeam === 'red' ? 'blue' : 'red';
            updateTurnDisplay();
            renderGame();
        }

        function passTurn() {
            endTurn();
        }

        function endGame(winningTeam, assassin) {
            gameState.gameOver = true;
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('gameOverScreen').classList.add('active');

            const message = document.getElementById('gameOverMessage');
            const teamName = winningTeam === 'red' ? gameState.redTeamName : gameState.blueTeamName;

            if (assassin) {
                message.className = 'game-over-message lose';
                message.textContent = `üíÄ ${teamName} Wins! (Other team hit the assassin)`;
            } else {
                message.className = `game-over-message win-${winningTeam}`;
                message.textContent = `üéâ ${teamName} Wins!`;
            }
        }

        function resetGame() {
            document.getElementById('gameOverScreen').classList.remove('active');
            document.getElementById('setupScreen').classList.add('active');
        }

        // Allow Enter key to submit clue
        document.getElementById('clueInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitClue();
            }
        });

        document.getElementById('numberInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitClue();
            }
        });
    </script>
</body>
</html>